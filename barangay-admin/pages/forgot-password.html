<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Barangay Admin — Forgot Password</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
  <link rel="stylesheet" href="../styles/login.css" />
</head>

<body class="bg-soft">

  <main class="d-flex min-vh-100 align-items-center justify-content-center p-3">
    <div class="auth-wrap" style="max-width:480px;">
      <div class="card shadow-lg rounded-4 overflow-hidden">
        <div class="card-body p-4 p-md-5">

          <h2 class="h5 fw-semibold mb-1">Forgot Password</h2>
          <p class="text-muted small mb-4">
            Enter your email and we’ll send you a reset link.
          </p>

          <!-- SUCCESS MESSAGE -->
          <div id="successMsg" class="alert alert-success d-none">
            If the email exists, a reset link has been sent.<br>
            Please wait before requesting another one.
          </div>

          <!-- ERROR MESSAGE -->
          <div id="errorMsg" class="alert alert-danger d-none"></div>

          <form id="forgotForm" action="../api/forgot_password.php" method="POST">

            <div class="mb-3">
              <label class="form-label small">Email</label>
              <input
                type="email"
                name="email"
                class="form-control form-control-lg"
                required
              />
            </div>

            <button
              id="btnSubmit"
              class="btn btn-success btn-lg w-100"
              type="submit">
              Send Reset Link
            </button>

            <div class="text-center mt-3">
              <a href="../../index.html" class="small">Back to login</a>
            </div>

          </form>

        </div>
      </div>
    </div>
  </main>

  <script>
    const params = new URLSearchParams(window.location.search);
    const sent = params.get('sent');

    const successMsg = document.getElementById('successMsg');
    const errorMsg   = document.getElementById('errorMsg');
    const btnSubmit  = document.getElementById('btnSubmit');

    const COOLDOWN_SECONDS = 60;
    const STORAGE_KEY = 'forgotPasswordCooldown';

    // --------------------------------------------------
    // SHOW SUCCESS MESSAGE IF ?sent=1
    // --------------------------------------------------
    if (sent === '1') {
      successMsg.classList.remove('d-none');
      startCooldown();
    }

    // --------------------------------------------------
    // COOLDOWN HANDLING
    // --------------------------------------------------
    function startCooldown() {
      const now = Date.now();
      localStorage.setItem(STORAGE_KEY, now);
      applyCooldown();
    }

    function applyCooldown() {
      const lastSent = localStorage.getItem(STORAGE_KEY);
      if (!lastSent) return;

      const elapsed = Math.floor((Date.now() - lastSent) / 1000);
      const remaining = COOLDOWN_SECONDS - elapsed;

      if (remaining <= 0) {
        btnSubmit.disabled = false;
        btnSubmit.textContent = 'Send Reset Link';
        localStorage.removeItem(STORAGE_KEY);
        return;
      }

      btnSubmit.disabled = true;
      btnSubmit.textContent = `Please wait (${remaining}s)`;

      setTimeout(applyCooldown, 1000);
    }

    // Apply cooldown on page load (refresh-safe)
    applyCooldown();
  </script>

</body>
</html>
